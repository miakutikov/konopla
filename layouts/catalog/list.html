{{ define "main" }}
<div class="container">
  {{ $catalog := site.Data.catalog }}
  {{ if $catalog }}
  <section class="catalog-page-layout">
    <!-- Category sidebar -->
    <aside class="categories-sidebar">
      <h3 class="sidebar-heading">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</h3>
      <ul class="categories-list">
        <li>
          <a href="#" class="category-item active" data-filter="all">
            <span class="category-name">–£—Å—ñ –∫–æ–º–ø–∞–Ω—ñ—ó</span>
            {{ $activeCount := 0 }}
            {{ range $catalog.companies }}{{ if eq .status "active" }}{{ $activeCount = add $activeCount 1 }}{{ end }}{{ end }}
            <span class="category-count">{{ $activeCount }}</span>
          </a>
        </li>
        {{ range sort $catalog.categories "order" }}
          {{ $catId := .id }}
          {{ $count := 0 }}
          {{ range $catalog.companies }}
            {{ if and (eq .category_id $catId) (eq .status "active") }}
              {{ $count = add $count 1 }}
            {{ end }}
          {{ end }}
          {{ if gt $count 0 }}
          <li>
            <a href="#{{ .id }}" class="category-item" data-filter="{{ .id }}">
              <span class="category-emoji">{{ .emoji }}</span>
              <span class="category-name">{{ .name }}</span>
              <span class="category-count">{{ $count }}</span>
            </a>
          </li>
          {{ end }}
        {{ end }}
      </ul>
    </aside>

    <!-- Catalog content -->
    <div class="catalog-content">
      <div class="news-content-header">
        <h1>–ö–∞—Ç–∞–ª–æ–≥ –∫–æ–º–ø–∞–Ω—ñ–π</h1>
        <p>–£–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –∫–æ–º–ø–∞–Ω—ñ—ó –ø—Ä–æ–º–∏—Å–ª–æ–≤–æ—ó –∫–æ–Ω–æ–ø–ª—è–Ω–æ—ó —ñ–Ω–¥—É—Å—Ç—Ä—ñ—ó</p>
      </div>

      {{ range sort $catalog.categories "order" }}
        {{ $catId := .id }}
        {{ $catName := .name }}
        {{ $catEmoji := .emoji }}
        {{ $companies := slice }}
        {{ range $catalog.companies }}
          {{ if and (eq .category_id $catId) (eq .status "active") }}
            {{ $companies = $companies | append . }}
          {{ end }}
        {{ end }}
        {{ if $companies }}
        <section class="catalog-category-section" id="{{ .id }}" data-category="{{ .id }}">
          <h2 class="catalog-category-heading">
            <span>{{ $catEmoji }}</span>
            {{ $catName }}
            <span class="catalog-category-count">({{ len $companies }})</span>
          </h2>
          <div class="catalog-grid">
            {{ range $companies }}
            <div class="company-card">
              <h3 class="company-name">{{ .name }}</h3>
              <p class="company-location">üìç {{ .location }}</p>
              <p class="company-description">{{ .description }}</p>
              <div class="company-contacts">
                {{ with .website }}
                <a href="{{ . }}" target="_blank" rel="noopener" class="company-link">üåê –°–∞–π—Ç</a>
                {{ end }}
                {{ with .phone }}
                <a href="tel:{{ . }}" class="company-link">üìû {{ . }}</a>
                {{ end }}
                {{ with .email }}
                <a href="mailto:{{ . }}" class="company-link">‚úâÔ∏è Email</a>
                {{ end }}
              </div>
            </div>
            {{ end }}
          </div>
        </section>
        {{ end }}
      {{ end }}
    </div>
  </section>
  {{ else }}
  <div class="empty-state">
    <h2>–ö–∞—Ç–∞–ª–æ–≥ –ø–æ—Ä–æ–∂–Ω—ñ–π</h2>
    <p>–ö–æ–º–ø–∞–Ω—ñ—ó –∑'—è–≤–ª—è—Ç—å—Å—è –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º.</p>
  </div>
  {{ end }}
</div>

<script>
(function() {
  var sidebar = document.querySelector('.categories-sidebar');
  if (!sidebar) return;
  sidebar.addEventListener('click', function(e) {
    var link = e.target.closest('[data-filter]');
    if (!link) return;
    e.preventDefault();
    var filter = link.dataset.filter;
    var sections = document.querySelectorAll('.catalog-category-section');
    var items = document.querySelectorAll('.category-item');
    items.forEach(function(i) { i.classList.remove('active'); });
    link.classList.add('active');
    if (filter === 'all') {
      sections.forEach(function(s) { s.style.display = ''; });
    } else {
      sections.forEach(function(s) {
        s.style.display = s.dataset.category === filter ? '' : 'none';
      });
    }
  });
})();
</script>
{{ end }}
