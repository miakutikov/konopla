{{ define "main" }}
<div class="container">

  {{ $allNews := where (where .Site.RegularPages "Section" "news") ".Params.draft" "ne" true }}
  {{ $news := $allNews.ByDate.Reverse }}

  {{ if $news }}

  {{/* --- Pinned article logic --- */}}
  {{ $pinned := .Site.Data.pinned }}
  {{ $pinnedArticle := false }}
  {{ $pinnedFilename := "" }}
  {{ if and $pinned $pinned.filename (ne $pinned.filename "") }}
    {{ $pinnedFilename = $pinned.filename }}
    {{ range $news }}
      {{ if eq .File.LogicalName $pinnedFilename }}
        {{ $pinnedArticle = . }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{/* --- Determine featured article and rest --- */}}
  {{ $featuredArticle := false }}
  {{ $rest := $news }}
  {{ $isPinned := false }}

  {{ if $pinnedArticle }}
    {{ $featuredArticle = $pinnedArticle }}
    {{ $rest = where $news ".File.LogicalName" "ne" $pinnedFilename }}
    {{ $isPinned = true }}
  {{ else }}
    {{ $featuredArticle = index $news 0 }}
    {{ $rest = after 1 $news }}
  {{ end }}

  {{/* --- Featured section --- */}}
  {{ with $featuredArticle }}
  <section class="featured-section">
    <article class="featured-card">
      <a href="{{ .Permalink }}" class="featured-image-link">
        {{ if .Params.image }}
        <img src="{{ .Params.image }}" alt="{{ .Title }}" class="featured-img">
        {{ else }}
        <div class="featured-img-placeholder">
          <img src="{{ "images/logo.png" | relURL }}" alt="KONOPLA.UA" class="placeholder-logo">
        </div>
        {{ end }}
      </a>
      <div class="featured-body">
        {{ if .Params.categories }}
        <a href="{{ "/categories/" | relURL }}{{ index .Params.categories 0 | urlize }}/" class="card-category">{{ index .Params.categories 0 | title }}</a>
        {{ end }}
        <h1 class="featured-title"><a href="{{ .Permalink }}">{{ .Title }}</a></h1>
        <p class="featured-summary">{{ if .Params.summary }}{{ .Params.summary }}{{ else }}{{ .Summary }}{{ end }}</p>
        <div class="card-meta">
          <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "02.01.2006" }}</time>
        </div>
      </div>
    </article>
  </section>
  {{ end }}

  <!-- News grid -->
  {{ if $rest }}
  <section class="news-section">
    <h2 class="section-title">Останні новини</h2>
    <div class="news-grid">
      {{ range first 11 $rest }}
        {{ partial "article-card.html" . }}
      {{ end }}
    </div>
    {{ if gt (len $rest) 11 }}
    <div class="more-news">
      <a href="{{ "/news/" | relURL }}" class="more-news-btn">Усі новини &rarr;</a>
    </div>
    {{ end }}
  </section>
  {{ end }}

  {{ else }}
  <section class="empty-state">
    <h2>Поки що новин немає</h2>
    <p>Перші новини з'являться найближчим часом.</p>
    <p>Підписуйтесь на <a href="{{ .Site.Params.telegram }}">Telegram-канал</a>, щоб не пропустити!</p>
  </section>
  {{ end }}

</div>
{{ end }}
